<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ScOpESens Mini App</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="index.css" />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
<link rel="stylesheet" href="/index.css">
</head>
<body>
  <div class="container">
    <header class="header">
      <div class="title">
        <span class="logo">🌊</span>
        <div>
          <h1>ScOpESens</h1>
          <p class="subtitle">Steuern & Überwachen in Telegram</p>
        </div>
      </div>
      <div class="toolbar">
        <button class="chip" data-action='{"type":"cmd","text":"/status"}'>📊 Chat-Status</button>
        <button class="chip" data-action='{"type":"cmd","text":"/limits"}'>⚙️ Limits</button>
        <button class="chip" data-action='{"type":"cmd","text":"/debug"}'>🐞 Debug</button>
      </div>
    </header>

    <section class="card" id="status-card">
      <div class="card-header">
        <h2>Live Status</h2>
        <button id="refreshStatus" class="refresh-btn" aria-label="Status aktualisieren">🔄</button>
      </div>
      <div id="status-grid" class="status-grid">
        <div class="status-item">
          <span class="icon">🧪</span>
          <span class="label">pH</span>
          <span class="value" id="status-ph">--</span>
        </div>
        <div class="status-item">
          <span class="icon">🌡️</span>
          <span class="label">Gehäuse-Temp.</span>
          <span class="value" id="status-aht-temp">-- °C</span>
        </div>
        <div class="status-item">
          <span class="icon">💧</span>
          <span class="label">Gehäuse-Feuchte</span>
          <span class="value" id="status-aht-humid">-- %</span>
        </div>
        <div class="status-item">
          <span class="icon">🌡️</span>
          <span class="label">Wasser-Temp.</span>
          <span class="value" id="status-ds-temp-1">-- °C</span>
        </div>
      </div>
       <div id="status-loading" class="status-loading-overlay hidden">
        <div class="spinner"></div>
      </div>
    </section>

    <section class="card">
      <h2>Relais</h2>
      <div id="relays" class="relay-list"></div>
      <div class="logic">
        <span class="logic-label">Logik:</span>
        <div class="segmented" data-group="relaylogic">
          <button class="segment active" data-value="active_low" data-action='{"type":"cmd","text":"/relaylogic active_low"}'>Active Low</button>
          <button class="segment" data-value="active_high" data-action='{"type":"cmd","text":"/relaylogic active_high"}'>Active High</button>
        </div>
      </div>
    </section>

    <section class="card">
      <h2>Log-Level</h2>
      <div class="segmented" data-group="loglevel">
        <button class="segment active" data-value="1" data-action='{"type":"cmd","text":"/loglevel 1"}'>Info</button>
        <button class="segment" data-value="2" data-action='{"type":"cmd","text":"/loglevel 2"}'>Warn</button>
        <button class="segment" data-value="3" data-action='{"type":"cmd","text":"/loglevel 3"}'>Error</button>
      </div>
    </section>

    <section class="card">
      <h2>Grenzwerte</h2>
      <div class="form">
        <div class="form-group">
          <label for="phmin">pH min</label>
          <input id="phmin" type="number" step="0.01" placeholder="6.50" />
        </div>
        <div class="form-group">
          <label for="phmax">pH max</label>
          <input id="phmax" type="number" step="0.01" placeholder="8.50" />
        </div>
        <div class="form-group">
          <label for="tmin">Temp min °C</label>
          <input id="tmin" type="number" step="0.1" placeholder="0.0" />
        </div>
        <div class="form-group">
          <label for="tmax">Temp max °C</label>
          <input id="tmax" type="number" step="0.1" placeholder="35.0" />
        </div>
         <div class="form-group">
          <label for="hmin">Feuchte min %</label>
          <input id="hmin" type="number" step="0.1" placeholder="20.0" />
        </div>
        <div class="form-group">
          <label for="hmax">Feuchte max %</label>
          <input id="hmax" type="number" step="0.1" placeholder="80.0" />
        </div>
      </div>
      <button id="saveLimits" class="btn primary">💾 Limits übernehmen</button>
    </section>

    <section class="card">
      <h2>pH-Kalibrierung</h2>
      <p class="calibration-hint">Einfache 1-Punkt Kalibrierung (Offset).</p>
      <div class="chips">
        <button class="chip" data-action='{"type":"cmd","text":"/phcal read"}'>🧪 Read</button>
        <button class="chip" data-action='{"type":"cmd","text":"/phcal cal7"}'>@ 7.00</button>
        <button class="chip" data-action='{"type":"cmd","text":"/phcal cal4"}'>@ 4.00</button>
        <button class="chip" data-action='{"type":"cmd","text":"/phcal clear"}'>Reset</button>
      </div>
       <p class="calibration-hint">Erweiterte 2-Punkt Kalibrierung (Slope & Offset).</p>
      <div class="chips">
        <button class="chip" data-action='{"type":"cmd","text":"/phcal begin"}'>Begin</button>
        <button class="chip" data-action='{"type":"cmd","text":"/phcal at7"}'>Set @7</button>
        <button class="chip" data-action='{"type":"cmd","text":"/phcal at4"}'>Set @4</button>
        <button class="chip" data-action='{"type":"cmd","text":"/phcal apply"}'>Apply</button>
        <button class="chip" data-action='{"type":"cmd","text":"/phcal state"}'>State</button>
      </div>
    </section>

    <p class="hint">Hinweis: Aktionen werden direkt an den Bot gesendet.</p>
  </div>
  <div id="background-animation"></div>
  <script src="index.tsx"></script>
<script type="module" src="/index.tsx"></script>
</body>
</html>